@using System;
@using System.Net;
@using misfits_festival.Shared.Models;
@using Dapper;
@using Npgsql;
@using misfits_festival.Client.Services;
@using misfits_festival.Client.Pages;
@using System.Net.Http;

@inject Blazored.LocalStorage.ILocalStorageService localStore

@page "/bruger"

<h3>Bruger side</h3>

    Din bruger email er: @brugerEmail

    <div class="parent">

        <div class="vagter">
            <!--<div class="ledigevagter">-->

            <h1>Ledige vagter</h1>

            <table>
                <tr>
                    <th>Dato</th>
                    <th>Vagt start</th>
                    <th>Vagt slut</th>
                    <th>Pause</th>
                    <th>Område</th>
                    <th>Opgave beskrivelse</th> <!--Dette skal evt laves til en join m. OpgaveBeskrivelse i stedet-->
                </tr>
                @foreach (var vagt in Vagter)
                {
                    <tr>
                        <td>@vagt.Dato</td>
                        <td>@vagt.VagtStart</td>
                        <td>@vagt.VagtSlut</td>
                        <td>@vagt.Pause</td>
                        <td>@vagt.Område</td>
                        <td>@vagt.OpgaveBeskrivelse</td>
                    </tr>
                }
            </table>
            <!--</div>-->

            <br />

            <!--<div class="brugervagter">-->

            <h1>Mine vagter</h1>

            <table>

                <tr>
                    <th>Vagt ID</th>
                    <th>Dato</th>
                    <th>Vagt start</th>
                    <th>Vagt slut</th>
                    <th>Pause</th>
                    <th>Område</th>
                    <th>Opgave beskrivelse</th> <!--Dette skal evt laves til en join m. OpgaveBeskrivelse i stedet-->
                    <th>Bruger email</th>
                </tr>
                @foreach (var vagt in BrugerVagter)
                {
                    <tr>
                        <td>@vagt.VagtId</td>
                        <td>@vagt.Dato</td>
                        <td>@vagt.VagtStart</td>
                        <td>@vagt.VagtSlut</td>
                        <td>@vagt.Pause</td>
                        <td>@vagt.Område</td>
                        <td>@vagt.OpgaveBeskrivelse</td>
                        <td>@vagt.BrugerEmail</td>
                    </tr>
                }

            </table>


        </div>

        <br />
        <br />

        <div class="kompetencer">

            <table>

                <tr>
                    <th>Kompetencer</th>
                </tr>
                <tr>
                    <td>Førstehjælpskursus</td>
                </tr>
                <tr>
                    <td>Kørekort</td>
                </tr>
                <tr>
                    <td>Køkkencertifikat</td>
                </tr>

            </table>

        </div>

        <!--</div>-->

    </div>


    @code {
        const string noteKey = "note";
        string brugerEmail = "";

        private List<Vagt> Vagter = new List<Vagt>();
        private List<Vagt> BrugerVagter = new List<Vagt>();

        private Vagt Vagt = new Vagt();

        [Inject]
        public IBrugerService BrugerService { get; set; } // laver en instans af vores interface

        [Inject]
        public IVagtService VagtService { get; set; }

        protected override async Task OnInitializedAsync()
        {
            brugerEmail = await localStore.GetItemAsync<string>(noteKey);
            Vagter = (await VagtService.GetLedigeVagter()).ToList();
            // int mitBrugerId = int.Parse(brugerId);
            BrugerVagter = (await VagtService.GetMineVagter(brugerEmail)).ToList();
        }


    }
